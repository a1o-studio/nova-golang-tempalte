name: {{SERVICE_NAME}}-app

services:
  {{SERVICE_NAME}}_db:
    image: postgres:17-alpine
    container_name: {{SERVICE_NAME}}_db
    environment:
      - POSTGRES_USER={{SERVICE_NAME}}
      - POSTGRES_PASSWORD={{SERVICE_NAME}}@pg
      - POSTGRES_DB={{SERVICE_NAME}}
    ports:
      - "5434:5432"
    volumes:
      - pgdata_{{SERVICE_NAME}}:/var/lib/postgresql/data
  redis:
    image: redis:8-alpine
    container_name: {{SERVICE_NAME}}_redis
    command: ["redis-server", "--requirepass", "${REDIS_PASSWORD}"]
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
  asynqmon:
    image: hibiken/asynqmon
    platform: linux/amd64
    container_name: {{SERVICE_NAME}}_asynqmon
    ports:
      - "8080:8080"
    environment:
      - REDIS_ADDR=redis:6379
      - REDIS_PASSWORD=${REDIS_PASSWORD}

volumes:
  pgdata_{{SERVICE_NAME}}:
  redis_data:
